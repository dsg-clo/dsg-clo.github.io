<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Branch Detail Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&display=swap");
      body {
        font-family: "Inter", sans-serif;
      }
      .tab-active {
        background-color: #1e40af !important;
        color: white !important;
        border-radius: 8px 8px 0 0;
        font-weight: bold;
      }
      .bg-card-blue {
        background-color: #f0f7ff;
      }
      .bg-card-green {
        background-color: #f0fff4;
      }
      .badge-white {
        background: white;
        padding: 2px 8px;
        border-radius: 6px;
        font-size: 10px;
        color: #64748b;
        border: 1px solid #e2e8f0;
      }
      .no-scrollbar::-webkit-scrollbar {
        display: none;
      }
    </style>
  </head>
  <body class="bg-gray-50 min-h-screen">
    <header
      class="bg-white border-b px-8 py-4 flex justify-between items-center shadow-sm sticky top-0 z-20"
    >
      <div>
        <h1 class="text-2xl font-black text-blue-900" id="pageBranchName">
          Loading...
        </h1>
        <p
          class="text-gray-400 text-xs uppercase tracking-widest font-bold mt-1"
          id="pageSubtitle"
        >
          Unit Profile Report
        </p>
      </div>
      <a
        href="profileuko.html"
        class="flex items-center gap-2 text-blue-600 font-bold hover:underline transition-all"
      >
        <span class="material-icons text-sm">arrow_back</span> Back to Filter
      </a>
    </header>

    <nav
      class="flex bg-white px-8 border-b sticky top-[73px] z-10 overflow-x-auto no-scrollbar gap-1 pt-2"
    >
      <button
        class="tab-btn px-6 py-4 whitespace-nowrap text-gray-500"
        data-target="tab-info"
      >
        Informasi
      </button>
      <button
        class="tab-btn px-6 py-4 whitespace-nowrap text-gray-500"
        data-target="tab-echannel"
      >
        E-Channel
      </button>
      <button
        class="tab-btn px-6 py-4 whitespace-nowrap text-gray-500"
        data-target="tab-perf"
      >
        Performance
      </button>
      <button
        class="tab-btn px-6 py-4 whitespace-nowrap text-gray-500"
        data-target="tab-hc"
      >
        Human Capital
      </button>
      <button
        class="tab-btn px-6 py-4 whitespace-nowrap text-gray-500"
        data-target="tab-customer"
      >
        Customer
      </button>
    </nav>

    <main class="p-8 max-w-7xl mx-auto">
      <section id="tab-info" class="tab-content hidden space-y-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-start">
          <div
            class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden flex flex-col max-h-[70vh]"
          >
            <div class="p-6 border-b bg-gray-50/50">
              <h3
                class="text-lg font-bold flex items-center gap-2 text-blue-900"
              >
                <span class="material-icons text-blue-600">business</span>Detail
                Unit Kerja
              </h3>
            </div>
            <div class="p-6 overflow-y-auto space-y-8">
              <div>
                <p
                  class="text-[10px] font-black text-blue-600 uppercase tracking-widest mb-4"
                >
                  I. Identitas Utama
                </p>
                <table class="w-full text-sm leading-8">
                  <tbody id="info-table-body" class="text-gray-700"></tbody>
                </table>
              </div>
              <hr class="border-gray-100" />
              <div>
                <p
                  class="text-[10px] font-black text-blue-600 uppercase tracking-widest mb-4"
                >
                  II. Status Gedung
                </p>
                <table class="w-full text-sm leading-8">
                  <tbody id="gedung-table-body" class="text-gray-700"></tbody>
                </table>
              </div>
              <hr class="border-gray-100" />
              <div>
                <p
                  class="text-[10px] font-black text-blue-600 uppercase tracking-widest mb-4"
                >
                  III. Fasilitas & Format
                </p>
                <div id="format-tags" class="flex flex-wrap gap-2"></div>
              </div>
            </div>
          </div>
          <div class="space-y-6">
            <div
              class="bg-white p-2 rounded-2xl shadow-md border border-gray-100"
            >
              <div
                class="aspect-video w-full rounded-xl bg-gray-200 overflow-hidden relative group"
              >
                <img
                  id="branch-image"
                  src=""
                  class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
                  alt="Branch Office"
                />
                <div
                  class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-4"
                >
                  <p
                    class="text-white font-bold text-sm flex items-center gap-2"
                  >
                    <span class="material-icons text-sm">photo_camera</span>
                    Foto Kantor
                  </p>
                </div>
              </div>
            </div>
            <div class="bg-card-blue p-6 rounded-2xl border border-blue-100">
              <h4
                class="text-sm font-bold text-blue-900 mb-2 flex items-center gap-2"
              >
                <span class="material-icons text-sm">place</span> Lokasi
                Koordinat
              </h4>
              <p id="info-koordinat" class="text-xs text-blue-600 font-mono">
                -
              </p>
            </div>
          </div>
        </div>
      </section>

      <section id="tab-echannel" class="tab-content hidden space-y-6">
        <div id="premises-container"></div>
        <div
          id="echannel-grid"
          class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4"
        ></div>
      </section>

      <section id="tab-perf" class="tab-content hidden space-y-8">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div
            class="bg-white p-8 rounded-2xl shadow-sm border-t-4 border-blue-600 text-center"
          >
            <p class="text-gray-400 text-xs font-black uppercase">KPI Score</p>
            <h2 id="perf-kpi" class="text-5xl font-black text-blue-900 mt-2">
              -
            </h2>
          </div>
          <div
            class="bg-white p-8 rounded-2xl shadow-sm border-t-4 border-green-500 text-center"
          >
            <p class="text-gray-400 text-xs font-black uppercase">
              Market Share DPK
            </p>
            <h2 id="perf-dpk" class="text-5xl font-black text-green-600 mt-2">
              -
            </h2>
          </div>
          <div
            class="bg-white p-8 rounded-2xl shadow-sm border-t-4 border-red-500 text-center"
          >
            <p class="text-gray-400 text-xs font-black uppercase">NPL Ratio</p>
            <h2 id="perf-npl" class="text-5xl font-black text-red-600 mt-2">
              -
            </h2>
          </div>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div
            class="bg-white p-6 rounded-2xl border border-gray-100 shadow-sm"
          >
            <h3 class="text-xs font-black text-gray-400 uppercase mb-4">
              DPK Trend (6 Months)
            </h3>
            <div class="h-40"><canvas id="mainDpkChart"></canvas></div>
          </div>
          <div
            class="bg-white p-6 rounded-2xl border border-gray-100 shadow-sm"
          >
            <h3 class="text-xs font-black text-gray-400 uppercase mb-4">
              Loan Growth Trend
            </h3>
            <div class="h-40"><canvas id="loanChart"></canvas></div>
          </div>
        </div>
      </section>

      <section id="tab-hc" class="tab-content hidden space-y-6">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
          <div
            class="bg-card-green p-6 rounded-xl shadow-sm border border-green-100 text-center"
          >
            <h4 class="text-gray-700 font-bold mb-4">Jumlah Formasi</h4>
            <p id="total-formasi" class="text-4xl font-black text-gray-800">
              0
            </p>
          </div>
          <div
            class="bg-card-green p-6 rounded-xl shadow-sm border border-green-100 text-center"
          >
            <h4 class="text-gray-700 font-bold mb-4">Jumlah Pemenuhan</h4>
            <p id="total-pemenuhan" class="text-4xl font-black text-gray-800">
              0
            </p>
          </div>
          <div
            class="bg-card-green p-6 rounded-xl shadow-sm border border-green-100 text-center"
          >
            <h4 class="text-gray-700 font-bold mb-4">Gap</h4>
            <p id="total-gap" class="text-4xl font-black text-red-600">0</p>
          </div>
        </div>
        <div
          class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden"
        >
          <table class="w-full text-left border-collapse">
            <thead
              class="bg-gray-50 text-gray-400 text-[10px] font-black uppercase border-b"
            >
              <tr>
                <th class="px-8 py-4">Jenis Formasi</th>
                <th class="px-8 py-4 text-center">Formasi</th>
                <th class="px-8 py-4 text-center">Pemenuhan</th>
                <th class="px-8 py-4 text-center">Gap</th>
              </tr>
            </thead>
            <tbody id="hc-table-body" class="divide-y text-sm"></tbody>
          </table>
        </div>
      </section>

      <section id="tab-customer" class="tab-content hidden space-y-8">
        <div
          class="bg-gradient-to-r from-blue-900 to-blue-700 p-10 rounded-3xl text-white shadow-xl flex justify-between items-center relative overflow-hidden"
        >
          <div class="relative z-10">
            <p
              class="text-blue-100 text-xs font-black uppercase tracking-[0.2em]"
            >
              Total CIF (Nasabah Active)
            </p>
            <h2 id="cust-total" class="text-6xl font-black mt-2 tracking-tight">
              0
            </h2>
          </div>
          <span
            class="material-icons text-[120px] absolute right-[-20px] opacity-10 rotate-12"
            >groups</span
          >
        </div>
        <div class="bg-white p-8 rounded-2xl shadow-sm border border-gray-100">
          <h3 class="text-lg font-black mb-8 text-gray-800">
            Demografi Berdasarkan Generasi
          </h3>
          <div
            id="cust-gen-container"
            class="grid grid-cols-1 sm:grid-cols-3 gap-6"
          ></div>
        </div>
      </section>
    </main>

    <script src="branchdetail.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const params = new URLSearchParams(window.location.search);
        const type = params.get("type") || "KC";
        const code = params.get("code") || "1190";

        let data = null;
        if (type === "KC") data = KC_DETAIL_DATA[code];
        else if (type === "REGION") data = REGION_DETAIL_DATA[code];
        else if (type === "AREA") data = AREA_DETAIL_DATA[code];
        else if (type === "KOKAB") data = KOKAB_DETAIL_DATA[code];
        else if (type === "UKER") data = UKER_DETAIL_DATA[code];
        if (!data) {
          document.body.innerHTML = `<div class='h-screen flex items-center justify-center'>Data Not Found</div>`;
          return;
        }

        // --- 1. IDENTITAS & HEADER ---
        const ident =
          data.identitas ||
          data.identreg ||
          data.identAREA ||
          data.identkab ||
          data.identUKER;
        document.getElementById("pageBranchName").innerText =
          ident.nama_unit_kerja || ident.nama_area || ident.nama_kab;
        document.getElementById("pageSubtitle").innerText = `${type} - ${
          ident.branch_code || ident.area_code || "N/A"
        }`;

        const infoBody = document.getElementById("info-table-body");
        const infoFields = {
          "Nama Unit":
            ident.nama_unit_kerja || ident.nama_area || ident.nama_kab,
          "Kode Unit": ident.branch_code || ident.area_code,
          "Kelas/Tipe": ident.kelas || ident.branch_type,
          Wilayah: ident.klasifikasi_wilayah,
          Alamat: ident.alamat,
          Provinsi: ident.provinsi,
        };
        Object.entries(infoFields).forEach(([k, v]) => {
          if (v && v !== "-")
            infoBody.innerHTML += `<tr><td class="font-bold w-40 text-gray-400 uppercase text-[10px]">${k}</td><td class="text-gray-800 font-semibold">: ${v}</td></tr>`;
        });

        const gedungBody = document.getElementById("gedung-table-body");
        if (data.kepemilikan_gedung) {
          Object.entries(data.kepemilikan_gedung).forEach(([k, v]) => {
            gedungBody.innerHTML += `<tr><td class="font-bold w-40 text-gray-400 uppercase text-[10px]">${k.replace(
              "_",
              " "
            )}</td><td class="text-gray-800 font-semibold">: ${v}</td></tr>`;
          });
        }

        const formatWrap = document.getElementById("format-tags");
        Object.entries(data.format_branch).forEach(([k, v]) => {
          formatWrap.innerHTML += `<div class="flex items-center gap-2 px-4 py-2 rounded-xl text-[10px] font-black border ${
            v
              ? "bg-green-50 text-green-700 border-green-100"
              : "bg-gray-50 text-gray-400 border-gray-100"
          }">${k
            .replace(/_/g, " ")
            .toUpperCase()} <span class="material-icons text-sm">${
            v ? "check_circle" : "cancel"
          }</span></div>`;
        });

        if (ident.foto_url)
          document.getElementById("branch-image").src = ident.foto_url;
        document.getElementById("info-koordinat").innerText =
          ident.koordinat || "Koordinat belum terdaftar";

        // --- 2. E-CHANNEL ---
        const premisesContainer = document.getElementById("premises-container");
        premisesContainer.innerHTML = `<div class="bg-card-green p-5 rounded-2xl border border-green-100 w-full sm:w-60"><div class="flex justify-between items-start mb-4"><span class="text-sm font-black text-green-800 uppercase">Premises</span><span class="badge-white">Mei</span></div><h2 class="text-4xl font-black text-gray-800">${
          data.performance_potensi.kpi.score
        }%</h2><p class="text-red-500 text-xs font-bold">↓ ${Math.abs(
          data.performance_potensi.kpi.trend
        )}%</p></div>`;

        const ecGrid = document.getElementById("echannel-grid");
        const channels = [
          { id: "atm", l: "ATM" },
          { id: "crm", l: "CRM" },
          { id: "edc", l: "EDC" },
          { id: "qris", l: "TERAS" },
          { id: "brilink", l: "Agen Brilink" },
        ];
        channels.forEach((ch) => {
          const item = data[ch.id];
          if (!item) return;
          ecGrid.innerHTML += `<div class="bg-card-blue p-5 rounded-2xl border border-blue-50 transition-all hover:shadow-md"><div class="flex justify-between items-center mb-6"><span class="font-black text-blue-900 text-sm uppercase">${
            ch.l
          }</span><span class="badge-white">Mei</span></div><div class="text-[11px] space-y-2 mb-6"><div class="flex justify-between text-gray-800 font-bold"><span>Jumlah</span><span>: ${
            item.jml
          }</span></div><div class="flex justify-between pl-3 text-gray-500"><span>Onsite</span><span>: ${
            item["on" + ch.id]
          }</span></div><div class="flex justify-between pl-3 text-gray-500"><span>Offsite</span><span>: ${
            item["off" + ch.id]
          }</span></div></div><div class="space-y-4 pt-4 border-t border-blue-100/50"><div><div class="flex justify-between text-[9px] font-black text-gray-400 uppercase"><span>Productivity</span></div><div class="flex justify-between items-end"><span class="text-xl font-black text-gray-800">${
            item["prd" + ch.id]
          }</span><span class="text-red-500 text-[9px] font-bold">↓ 1.5%</span></div></div></div></div>`;
        });

        // --- 3. PERFORMANCE ---
        document.getElementById("perf-kpi").innerText =
          data.performance_potensi.kpi.score + "%";
        document.getElementById("perf-dpk").innerText =
          data.performance_potensi.total_dpk.market_share_total + "%";
        document.getElementById("perf-npl").innerText =
          data.performance_potensi.kredit.npl.current_value;

        // RENDER GRAFIK
        initLineChart(
          "mainDpkChart",
          [40, 55, 45, 70, 60, 85],
          "#2563eb",
          true
        );
        initLineChart(
          "loanChart",
          [100, 120, 110, 150, 140, 190],
          "#1e40af",
          true
        );

        // --- 4. HUMAN CAPITAL ---
        const hcBody = document.getElementById("hc-table-body");
        let sumF = 0,
          sumP = 0,
          sumG = 0;
        data.human_capital.detail_formasi.forEach((row) => {
          sumF += row.formasi;
          sumP += row.pemenuhan;
          sumG += row.gap;
          hcBody.innerHTML += `<tr class="hover:bg-blue-50/50 transition-colors"><td class="px-8 py-5 font-bold text-gray-700">${
            row.jabatan
          }</td><td class="px-8 py-5 text-center font-semibold text-gray-500">${
            row.formasi
          }</td><td class="px-8 py-5 text-center text-blue-600 font-black">${
            row.pemenuhan
          }</td><td class="px-8 py-5 text-center"><span class="${
            row.gap > 0
              ? "text-red-600 bg-red-50 px-3 py-1 rounded-full font-black"
              : "text-gray-300"
          }">${row.gap}</span></td></tr>`;
        });
        document.getElementById("total-formasi").innerText = sumF;
        document.getElementById("total-pemenuhan").innerText = sumP;
        document.getElementById("total-gap").innerText = sumG;

        // --- 5. CUSTOMER ---
        document.getElementById("cust-total").innerText =
          data.customer.total_cif.total.toLocaleString("id-ID");
        const genContainer = document.getElementById("cust-gen-container");
        data.customer.demographic_generation.forEach((g) => {
          genContainer.innerHTML += `<div class="bg-gray-50 p-6 rounded-2xl border border-gray-100"><p class="text-gray-400 text-[10px] font-black uppercase tracking-widest">${
            g.label
          }</p><p class="text-2xl font-black text-blue-900 mt-2">${g.value.toLocaleString(
            "id-ID"
          )}</p></div>`;
        });

        // TAB LOGIC
        const tabs = document.querySelectorAll(".tab-btn");
        tabs.forEach((btn) => {
          btn.addEventListener("click", () => {
            tabs.forEach((b) => b.classList.remove("tab-active"));
            document
              .querySelectorAll(".tab-content")
              .forEach((c) => c.classList.add("hidden"));
            btn.classList.add("tab-active");
            document
              .getElementById(btn.dataset.target)
              .classList.remove("hidden");
          });
        });
        tabs[0].click();
      });
    </script>
  </body>
</html>
