<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Analisa Profile Uko</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&display=swap");
      body {
        font-family: "Inter", sans-serif;
      }
      .tab-active {
        background-color: #1e40af !important;
        color: white !important;
        border-radius: 8px 8px 0 0;
        font-weight: bold;
      }
      .bg-card-blue {
        background-color: #f0f7ff;
      }
      .bg-card-green {
        background-color: #f0fff4;
      }
      .badge-white {
        background: white;
        padding: 2px 8px;
        border-radius: 6px;
        font-size: 10px;
        color: #64748b;
        border: 1px solid #e2e8f0;
      }
      .no-scrollbar::-webkit-scrollbar {
        display: none;
      }
    </style>
  </head>
  <body class="bg-gray-50 min-h-screen">
    <header
      class="bg-white border-b px-8 py-4 flex justify-between items-center shadow-sm sticky top-0 z-20"
    >
      <div>
        <h1 class="text-2xl font-black text-blue-900" id="pageBranchName">
          Loading...
        </h1>
        <p
          class="text-gray-400 text-xs uppercase tracking-widest font-bold mt-1"
          id="pageSubtitle"
        >
          Unit Profile Report
        </p>
      </div>
      <a
        href="profileuko.html"
        class="flex items-center gap-2 text-blue-600 font-bold hover:underline transition-all"
      >
        <span class="material-icons text-sm">arrow_back</span> Back to Filter
      </a>
    </header>

    <nav
      class="flex bg-white px-8 border-b sticky top-[73px] z-10 overflow-x-auto no-scrollbar gap-1 pt-2"
    >
      <button
        class="tab-btn px-6 py-4 whitespace-nowrap text-gray-500 font-bold"
        data-target="tab-info"
      >
        Informasi
      </button>
      <button
        class="tab-btn px-6 py-4 whitespace-nowrap text-gray-500 font-bold"
        data-target="tab-echannel"
      >
        E-Channel
      </button>
      <button
        class="tab-btn px-6 py-4 whitespace-nowrap text-gray-500 font-bold"
        data-target="tab-perf"
      >
        Performance
      </button>
      <button
        class="tab-btn px-6 py-4 whitespace-nowrap text-gray-500 font-bold"
        data-target="tab-hc"
      >
        Human Capital
      </button>
      <button
        class="tab-btn px-6 py-4 whitespace-nowrap text-gray-500 font-bold"
        data-target="tab-customer"
      >
        Customer
      </button>
    </nav>

    <main class="p-8 max-w-7xl mx-auto">
      <section id="tab-info" class="tab-content hidden space-y-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-start">
          <div
            class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden flex flex-col max-h-[75vh]"
          >
            <div class="p-6 border-b bg-gray-50/50">
              <h3
                class="text-lg font-bold flex items-center gap-2 text-blue-900"
              >
                <span class="material-icons text-blue-600">business</span>Detail
                Unit Kerja
              </h3>
            </div>
            <div class="p-6 overflow-y-auto space-y-8">
              <div>
                <p
                  class="text-[10px] font-black text-blue-600 uppercase tracking-widest mb-4"
                >
                  I. Identitas Utama
                </p>
                <table class="w-full text-sm leading-8">
                  <tbody id="info-table-body" class="text-gray-700"></tbody>
                </table>
              </div>
              <hr class="border-gray-100" />
              <div>
                <p
                  class="text-[10px] font-black text-blue-600 uppercase tracking-widest mb-4"
                >
                  II. Status Gedung
                </p>
                <table class="w-full text-sm leading-8">
                  <tbody id="gedung-table-body" class="text-gray-700"></tbody>
                </table>
              </div>
              <hr class="border-gray-100" />
              <div>
                <p
                  class="text-[10px] font-black text-blue-600 uppercase tracking-widest mb-4"
                >
                  III. Fasilitas & Format
                </p>
                <div id="format-tags" class="flex flex-wrap gap-2"></div>
              </div>
            </div>
          </div>
          <div class="space-y-6">
            <div
              class="bg-white p-2 rounded-2xl shadow-md border border-gray-100"
            >
              <div
                class="aspect-video w-full rounded-xl bg-gray-200 overflow-hidden relative group"
              >
                <img
                  id="branch-image"
                  src=""
                  class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
                  alt="Office"
                />
                <div
                  class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-4"
                >
                  <p
                    class="text-white font-bold text-sm flex items-center gap-2"
                  >
                    <span class="material-icons text-sm">photo_camera</span>
                    Foto Kantor
                  </p>
                </div>
              </div>
            </div>
            <div class="bg-card-blue p-6 rounded-2xl border border-blue-100">
              <h4
                class="text-sm font-bold text-blue-900 mb-2 flex items-center gap-2"
              >
                <span class="material-icons text-sm">place</span> Lokasi
                Koordinat
              </h4>
              <p id="info-koordinat" class="text-xs text-blue-600 font-mono">
                -
              </p>
            </div>
          </div>
        </div>
      </section>

      <section id="tab-echannel" class="tab-content hidden space-y-6">
        <div id="premises-container"></div>
        <div
          id="echannel-grid"
          class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4"
        ></div>
      </section>

      <section id="tab-perf" class="tab-content hidden space-y-8">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div
            class="bg-white p-8 rounded-2xl shadow-sm border-t-4 border-blue-600 text-center"
          >
            <p class="text-gray-400 text-xs font-black uppercase">KPI Score</p>
            <h2 id="perf-kpi" class="text-5xl font-black text-blue-900 mt-2">
              -
            </h2>
          </div>
          <div
            class="bg-white p-8 rounded-2xl shadow-sm border-t-4 border-green-500 text-center"
          >
            <p class="text-gray-400 text-xs font-black uppercase">
              Market Share DPK
            </p>
            <h2 id="perf-dpk" class="text-5xl font-black text-green-600 mt-2">
              -
            </h2>
          </div>
          <div
            class="bg-white p-8 rounded-2xl shadow-sm border-t-4 border-red-500 text-center"
          >
            <p class="text-gray-400 text-xs font-black uppercase">NPL Ratio</p>
            <h2 id="perf-npl" class="text-5xl font-black text-red-600 mt-2">
              -
            </h2>
          </div>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div
            class="bg-white p-6 rounded-2xl border border-gray-100 shadow-sm"
          >
            <h3
              class="text-xs font-black text-gray-400 uppercase mb-4 text-center"
            >
              DPK Trend
            </h3>
            <div class="h-48"><canvas id="mainDpkChart"></canvas></div>
          </div>
          <div
            class="bg-white p-6 rounded-2xl border border-gray-100 shadow-sm"
          >
            <h3
              class="text-xs font-black text-gray-400 uppercase mb-4 text-center"
            >
              Loan Growth Trend
            </h3>
            <div class="h-48"><canvas id="loanChart"></canvas></div>
          </div>
        </div>
      </section>

      <section id="tab-hc" class="tab-content hidden space-y-6">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
          <div
            class="bg-card-green p-6 rounded-xl shadow-sm border border-green-100 text-center"
          >
            <h4 class="text-gray-700 font-bold mb-4">Jumlah Formasi</h4>
            <p id="total-formasi" class="text-4xl font-black text-gray-800">
              0
            </p>
          </div>
          <div
            class="bg-card-green p-6 rounded-xl shadow-sm border border-green-100 text-center"
          >
            <h4 class="text-gray-700 font-bold mb-4">Jumlah Pemenuhan</h4>
            <p id="total-pemenuhan" class="text-4xl font-black text-gray-800">
              0
            </p>
          </div>
          <div
            class="bg-card-green p-6 rounded-xl shadow-sm border border-green-100 text-center"
          >
            <h4 class="text-gray-700 font-bold mb-4">Gap</h4>
            <p id="total-gap" class="text-4xl font-black text-red-600">0</p>
          </div>
        </div>
        <div
          class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden"
        >
          <table class="w-full text-left border-collapse">
            <thead
              class="bg-gray-50 text-gray-400 text-[10px] font-black uppercase border-b"
            >
              <tr>
                <th class="px-8 py-4">Jenis Formasi</th>
                <th class="px-8 py-4 text-center">Formasi</th>
                <th class="px-8 py-4 text-center">Pemenuhan</th>
                <th class="px-8 py-4 text-center">Gap</th>
              </tr>
            </thead>
            <tbody id="hc-table-body" class="divide-y text-sm"></tbody>
          </table>
        </div>
      </section>

      <section id="tab-customer" class="tab-content hidden space-y-8">
        <div
          class="bg-gradient-to-br from-blue-950 via-blue-900 to-indigo-900 p-10 rounded-[2.5rem] text-white shadow-xl flex justify-between items-center relative overflow-hidden"
        >
          <div class="relative z-10">
            <p
              class="text-blue-300 text-xs font-black uppercase tracking-[0.3em] mb-2"
            >
              Total CIF (Nasabah Active)
            </p>
            <h2
              id="cust-total"
              class="text-7xl font-black tracking-tighter italic"
            >
              0
            </h2>
          </div>
          <span
            class="material-icons text-[150px] absolute right-[-10px] opacity-10 rotate-12"
            >groups</span
          >
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
          <div
            id="cust-gen-container"
            class="lg:col-span-8 grid grid-cols-1 sm:grid-cols-2 gap-4"
          ></div>
          <div
            class="lg:col-span-4 bg-white p-8 rounded-[2.5rem] shadow-sm border border-gray-100 flex flex-col items-center justify-center"
          >
            <h3
              class="text-[10px] font-black text-gray-400 uppercase tracking-widest mb-6"
            >
              Demographic Share
            </h3>
            <div class="w-full max-w-[220px] aspect-square">
              <canvas id="customerPieChart"></canvas>
            </div>
          </div>
        </div>
      </section>
    </main>

    <script src="branchdetail.js"></script>
    <script>
      let charts = {};

      function initLineChart(id, labels, data, color) {
        const ctx = document.getElementById(id).getContext("2d");
        if (charts[id]) charts[id].destroy();
        charts[id] = new Chart(ctx, {
          type: "line",
          data: {
            labels: labels,
            datasets: [
              {
                data: data,
                borderColor: color,
                backgroundColor: color + "15",
                fill: true,
                tension: 0.4,
                borderWidth: 3,
                pointRadius: 3,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
          },
        });
      }

      function initPieChart(id, labels, data) {
        const ctx = document.getElementById(id).getContext("2d");
        if (charts[id]) charts[id].destroy();
        charts[id] = new Chart(ctx, {
          type: "doughnut",
          data: {
            labels: labels,
            datasets: [
              {
                data: data,
                backgroundColor: ["#1e3a8a", "#2563eb", "#60a5fa", "#94a3b8"],
                borderWidth: 0,
              },
            ],
          },
          options: {
            responsive: true,
            plugins: {
              legend: {
                position: "bottom",
                labels: { boxWidth: 12, font: { weight: "bold", size: 10 } },
              },
            },
            cutout: "75%",
          },
        });
      }

      document.addEventListener("DOMContentLoaded", () => {
        const params = new URLSearchParams(window.location.search);
        const type = params.get("type") || "KC";
        const code = params.get("code") || "1190";

        let data =
          type === "KC"
            ? KC_DETAIL_DATA[code]
            : type === "REGION"
              ? REGION_DETAIL_DATA[code]
              : type === "AREA"
                ? AREA_DETAIL_DATA[code]
                : type === "UKER"
                  ? UKER_DETAIL_DATA[code]
                  : null;

        if (!data) return;

        // 1. IDENTITAS
        const ident =
          data.identitas || data.identreg || data.identAREA || data.identUKER;
        document.getElementById("pageBranchName").innerText =
          ident.nama_unit_kerja || ident.nama_area;
        document.getElementById("pageSubtitle").innerText =
          `${type} - ${ident.branch_code || code}`;
        document.getElementById("info-koordinat").innerText =
          ident.koordinat || "Koordinat belum terdaftar";
        if (ident.foto_url)
          document.getElementById("branch-image").src = ident.foto_url;

        const infoBody = document.getElementById("info-table-body");
        Object.entries({
          "Nama Unit": ident.nama_unit_kerja,
          "Kode Unit": ident.branch_code,
          "Kelas/Tipe": ident.kelas,
          Wilayah: ident.klasifikasi_wilayah,
          Alamat: ident.alamat,
        }).forEach(([k, v]) => {
          if (v)
            infoBody.innerHTML += `<tr><td class="font-bold w-40 text-gray-400 uppercase text-[10px]">${k}</td><td class="text-gray-800 font-semibold">: ${v}</td></tr>`;
        });

        const gedungBody = document.getElementById("gedung-table-body");
        if (data.kepemilikan_gedung)
          Object.entries(data.kepemilikan_gedung).forEach(([k, v]) => {
            gedungBody.innerHTML += `<tr><td class="font-bold w-40 text-gray-400 uppercase text-[10px]">${k.replace("_", " ")}</td><td class="text-gray-800 font-semibold">: ${v}</td></tr>`;
          });

        const formatWrap = document.getElementById("format-tags");
        Object.entries(data.format_branch).forEach(([k, v]) => {
          formatWrap.innerHTML += `<div class="flex items-center gap-2 px-4 py-2 rounded-xl text-[10px] font-black border ${v ? "bg-green-50 text-green-700 border-green-100" : "bg-gray-50 text-gray-400 border-gray-100"}">${k.replace(/_/g, " ").toUpperCase()} <span class="material-icons text-sm">${v ? "check_circle" : "cancel"}</span></div>`;
        });

        // 2. E-CHANNEL
        document.getElementById("premises-container").innerHTML =
          `<div class="bg-card-green p-5 rounded-2xl border border-green-100 w-full sm:w-60"><div class="flex justify-between items-start mb-4"><span class="text-sm font-black text-green-800 uppercase">Premises</span><span class="badge-white">Mei</span></div><h2 class="text-4xl font-black text-gray-800">${data.performance_potensi.kpi.score}%</h2><p class="text-red-500 text-xs font-bold">↓ ${Math.abs(data.performance_potensi.kpi.trend)}%</p></div>`;

        const ecGrid = document.getElementById("echannel-grid");
        const channels = [
          { id: "atm", l: "ATM" },
          { id: "crm", l: "CRM" },
          { id: "edc", l: "EDC" },
          { id: "qris", l: "TERAS" },
          { id: "brilink", l: "Agen Brilink" },
        ];
        channels.forEach((ch) => {
          const item = data[ch.id];
          if (!item) return;
          ecGrid.innerHTML += `
            <div class="bg-card-blue p-5 rounded-2xl border border-blue-50 transition-all hover:shadow-md">
                <div class="flex justify-between items-center mb-6"><span class="font-black text-blue-900 text-sm uppercase">${ch.l}</span><span class="badge-white">Mei</span></div>
                <div class="text-[11px] space-y-2 mb-6">
                    <div class="flex justify-between text-gray-800 font-bold"><span>Jumlah</span><span>: ${item.jml}</span></div>
                    <div class="flex justify-between pl-3 text-gray-500"><span>Onsite</span><span>: ${item["on" + ch.id] || 0}</span></div>
                    <div class="flex justify-between pl-3 text-gray-500"><span>Offsite</span><span>: ${item["off" + ch.id] || 0}</span></div>
                </div>
                <div class="space-y-4 pt-4 border-t border-blue-100/50">
                    <div>
                        <div class="flex justify-between text-[9px] font-black text-gray-400 uppercase"><span>Productivity</span></div>
                        <div class="flex justify-between items-end">
                            <span class="text-xl font-black text-gray-800">${item["prd" + ch.id] || "0%"}</span>
                            <span class="text-red-500 text-[9px] font-bold">↓ 1.5%</span>
                        </div>
                    </div>
                </div>
            </div>`;
        });

        // 3. PERFORMANCE
        document.getElementById("perf-kpi").innerText =
          data.performance_potensi.kpi.score + "%";
        document.getElementById("perf-dpk").innerText =
          data.performance_potensi.total_dpk.market_share_total + "%";
        document.getElementById("perf-npl").innerText =
          data.performance_potensi.kredit.npl.current_value;
        initLineChart(
          "mainDpkChart",
          data.performance_potensi.total_dpk.trend_labels,
          data.performance_potensi.total_dpk.trend_values,
          "#2563eb",
        );
        initLineChart(
          "loanChart",
          data.performance_potensi.kredit.trend_labels,
          data.performance_potensi.kredit.trend_values,
          "#1e40af",
        );

        // 4. HUMAN CAPITAL
        const hcBody = document.getElementById("hc-table-body");
        let sF = 0,
          sP = 0,
          sG = 0;
        data.human_capital.detail_formasi.forEach((r) => {
          sF += r.formasi;
          sP += r.pemenuhan;
          sG += r.gap;
          hcBody.innerHTML += `<tr class="hover:bg-blue-50/50 transition-colors"><td class="px-8 py-5 font-bold text-gray-700">${r.jabatan}</td><td class="px-8 py-5 text-center font-semibold text-gray-500">${r.formasi}</td><td class="px-8 py-5 text-center text-blue-600 font-black">${r.pemenuhan}</td><td class="px-8 py-5 text-center"><span class="${r.gap > 0 ? "text-red-600 bg-red-50 px-3 py-1 rounded-full font-black" : "text-gray-300"}">${r.gap}</span></td></tr>`;
        });
        document.getElementById("total-formasi").innerText = sF;
        document.getElementById("total-pemenuhan").innerText = sP;
        document.getElementById("total-gap").innerText = sG;

        // 5. CUSTOMER (MODERN STYLE)
        document.getElementById("cust-total").innerText =
          data.customer.total_cif.total.toLocaleString("id-ID");
        const genCont = document.getElementById("cust-gen-container");
        const genIcons = {
          Boomers: "elderly",
          "Gen X": "person",
          Millennials: "devices",
          "Gen Z": "bolt",
        };
        const cLabels = [],
          cValues = [];

        data.customer.demographic_generation.forEach((g) => {
          cLabels.push(g.label);
          cValues.push(g.value);
          const icon = genIcons[g.label] || "groups";
          genCont.innerHTML += `
            <div class="bg-white p-6 rounded-[2rem] border border-gray-100 shadow-sm flex items-center justify-between hover:shadow-md transition-shadow">
                <div>
                    <p class="text-gray-400 text-[10px] font-black uppercase tracking-widest">${g.label}</p>
                    <p class="text-3xl font-black text-blue-900 mt-1">${g.value.toLocaleString("id-ID")}</p>
                </div>
                <div class="bg-blue-50 text-blue-600 w-12 h-12 rounded-2xl flex items-center justify-center">
                    <span class="material-icons">${icon}</span>
                </div>
            </div>`;
        });
        initPieChart("customerPieChart", cLabels, cValues);

        // TABS
        const tabs = document.querySelectorAll(".tab-btn");
        tabs.forEach((btn) =>
          btn.addEventListener("click", () => {
            tabs.forEach((b) => b.classList.remove("tab-active"));
            document
              .querySelectorAll(".tab-content")
              .forEach((c) => c.classList.add("hidden"));
            btn.classList.add("tab-active");
            document
              .getElementById(btn.dataset.target)
              .classList.remove("hidden");
          }),
        );
        tabs[0].click();
      });
    </script>
  </body>
</html>
