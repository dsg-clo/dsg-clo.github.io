<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BRImaps v2</title>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Leaflet -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- Material Icons -->
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />

    <style>
      html,
      body {
        height: 100%;
        margin: 0;
        overflow: hidden;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }
      #map {
        height: 100%;
      }
      .sidebar-icon {
        padding: 12px;
        cursor: pointer;
        color: #9ca3af;
      }
      .sidebar-icon:hover {
        background: #374151;
        color: white;
      }
    </style>
  </head>

  <body class="flex bg-gray-100">
    <!-- SIDEBAR -->
    <aside class="w-14 bg-[#1e1e1e] flex flex-col items-center py-4 z-50">
      <span class="material-icons text-blue-500 mb-8">layers</span>
      <div class="sidebar-icon bg-blue-600 text-white rounded">
        <span class="material-icons">dashboard</span>
      </div>
      <div class="sidebar-icon mt-auto">
        <span class="material-icons">settings</span>
      </div>
    </aside>

    <!-- MAIN -->
    <div class="flex-1 relative">
      <div id="map"></div>
    </div>

    <!-- INFO PANEL -->
    <div
      id="infoPanel"
      class="absolute top-4 left-4 w-96 bg-white shadow-xl rounded-lg border hidden z-[1500]"
    >
      <div class="px-4 py-3 border-b flex justify-between">
        <h3 class="font-bold text-sm" id="p-name"></h3>
        <button onclick="closeInfoPanel()">
          <span class="material-icons text-gray-400">close</span>
        </button>
      </div>

      <div class="p-4 text-xs">
        <table class="w-full leading-6">
          <tr>
            <td class="text-gray-500 w-32">Jenis</td>
            <td id="p-type"></td>
          </tr>
          <tr>
            <td class="text-gray-500">Kode</td>
            <td id="p-code"></td>
          </tr>
          <tr>
            <td class="text-gray-500">Desa</td>
            <td id="p-desa"></td>
          </tr>
          <tr>
            <td class="text-gray-500">Kecamatan</td>
            <td id="p-kec"></td>
          </tr>
          <tr>
            <td class="text-gray-500">Kota</td>
            <td id="p-kota"></td>
          </tr>
          <tr>
            <td class="text-gray-500">Alamat</td>
            <td id="p-alamat"></td>
          </tr>
        </table>

        <button
          class="mt-4 w-full bg-blue-600 text-white py-2 rounded text-xs font-semibold"
          onclick="openModalFromPanel()"
        >
          More Info
        </button>
      </div>
    </div>

    <!-- MODAL -->
    <div
      id="detailModal"
      class="fixed inset-0 bg-black/40 hidden z-[2000] flex items-center justify-center"
    >
      <div class="bg-white w-[90%] max-w-xl rounded-lg shadow-xl">
        <div class="px-6 py-3 border-b flex justify-between">
          <h2 class="font-bold" id="modalBranchName"></h2>
          <button onclick="closeModal()">
            <span class="material-icons">close</span>
          </button>
        </div>

        <div class="p-6 text-sm">
          <p><b>Nama:</b> <span id="m-name"></span></p>
          <p><b>Kode:</b> <span id="m-code"></span></p>
        </div>
      </div>
    </div>

    <script>
      const map = L.map("map").setView([0.79, 102.02], 10);

      L.tileLayer(
        "https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png"
      ).addTo(map);

      const branchData = [
        {
          name: "KC Siak",
          code: "1190",
          type: "KC",
          desa: "Kampung Dalam",
          kec: "Siak",
          kota: "Kab. Siak",
          alamat: "Jl. Raja Kecik",
          pos: [0.798317, 102.049247],
        },
        {
          name: "KC Perawang",
          code: "1234",
          type: "KC",
          desa: "Perawang",
          kec: "Tualang",
          kota: "Kab. Siak",
          alamat: "Jl. Raya Perawang",
          pos: [0.68, 101.62],
        },
      ];

      let selectedItem = null;

      function openInfoPanel(item) {
        selectedItem = item;

        document.getElementById("p-name").innerText = item.name;
        document.getElementById("p-type").innerText = item.type;
        document.getElementById("p-code").innerText = item.code;
        document.getElementById("p-desa").innerText = item.desa;
        document.getElementById("p-kec").innerText = item.kec;
        document.getElementById("p-kota").innerText = item.kota;
        document.getElementById("p-alamat").innerText = item.alamat;

        document.getElementById("infoPanel").classList.remove("hidden");
      }

      function closeInfoPanel() {
        document.getElementById("infoPanel").classList.add("hidden");
      }

      function openModalFromPanel() {
        closeInfoPanel();
        openModal(selectedItem);
      }

      function openModal(item) {
        document.getElementById("modalBranchName").innerText = item.name;
        document.getElementById("m-name").innerText = item.name;
        document.getElementById("m-code").innerText = item.code;
        document.getElementById("detailModal").classList.remove("hidden");
      }

      function closeModal() {
        document.getElementById("detailModal").classList.add("hidden");
      }

      branchData.forEach((item) => {
        L.circleMarker(item.pos, {
          radius: 8,
          fillColor: "#1e3a8a",
          color: "#fff",
          weight: 2,
          fillOpacity: 1,
        })
          .addTo(map)
          .on("click", () => openInfoPanel(item));
      });
    </script>
  </body>
</html>
